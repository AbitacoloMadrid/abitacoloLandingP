---
import { Image } from "astro:assets";
import ajustes from "../image/iconoAjustes.webp";
import logoA from "../image/logos/ANegra.webp";
---

<div
  id="cookieModal"
  class="fixed inset-0 z-50 hidden w-full h-full items-center justify-center bg-black bg-opacity-50 p-10"
  role="dialog"
  aria-labelledby="cookieModalTitle"
  aria-describedby="cookieModalDescription"
>
  <div
    class="grid min-h-[89px] max-w-[1107px] justify-between xl:w-full items-center gap-6 rounded-2xl border-4 border-[#919e32] bg-white px-4 pt-4 pb-2.5 min-[1205px]:flex"
  >
    <h2 id="cookieModalTitle" class="sr-only">Consentimiento de Cookies</h2>
    <p id="cookieModalDescription" class="sr-only">
      Elige tus preferencias de cookies
    </p>

    <div class="flex justify-around min-[1205px]:gap-6">
      <div style={{ minWidth: "69px", minHeight: "69px" }}>
        <Image
          src={logoA}
          alt="Icono de información"
          width={69}
          height={69}
          loading="eager"
        />
      </div>

      <p class="leading-5 tracking-wide text-lg my-auto max-[450px]:max-w-32">
        Nos preocupa <strong>tu privacidad</strong>
      </p>
    </div>

    <div
      class="inline-flex max-w-[342px] min-h-[29px] flex-col items-start justify-start"
    >
      <div class="self-stretch text-sm text-[#37474f]">
        Utilizamos cookies para mejorar tu experiencia en nuestra web. Estas
        almacenan información sobre tus preferencias. <a
          href="/terminos-y-condiciones"
          class="text-blue-600 cursor-pointer hover:text-blue-800"
          >Consulta nuestra política de privacidad.</a
        >
      </div>
    </div>
    <div
      class="flex items-center justify-center gap-1.5 rounded-full bg-[#717C27]"
    >
      <button
        id="acceptAll"
        class="grid w-full justify-center px-7 py-2.5 text-sm font-semibold leading-[16.80px] text-white"
      >
        Aceptar todas
      </button>
    </div>
    <!-- <button
      id="customize"
      class="flex items-center justify-center gap-1.5 rounded-full border-2 border-[#666666] px-7 py-2.5"
    >
      <div class="text-sm font-semibold leading-[16.80px] text-[#666666]">
        Personalizar
      </div>
      <div class="relative w-4 h-4">
        <div style={{ minWidth: "24px", minHeight: "26px" }}>
          <Image
            src={ajustes}
            alt="Icono de ajustes"
            width={24}
            height={26}
            loading="eager"
          />
        </div>
      </div>
    </button> -->
    <div class="flex h-10 items-start justify-center gap-4">
      <button
        id="rejectAll"
        class="flex items-center justify-center gap-2.5 py-[9px]"
      >
        <div
          class="text-center text-sm font-medium uppercase tracking-wider text-[#37474f]"
        >
          RECHAZAR TODAS
        </div>
      </button>
    </div>
  </div>
</div>
<script>
  const STORAGE_KEY = "cookieConsent";
  const COOKIE_NAME = "cookieConsent";

  function getStoredConsent() {
    return localStorage.getItem(STORAGE_KEY);
  }

  function setStoredConsent(value) {
    localStorage.setItem(STORAGE_KEY, value);
    setCookie(COOKIE_NAME, value, 365); // Set cookie for 1 year
  }

  function showModal() {
    const storedConsent = getStoredConsent();
    if (!storedConsent) {
      document.getElementById("cookieModal").classList.remove("hidden");
      document.getElementById("cookieModal").classList.add("flex");
    }
  }

  function closeModal() {
    document.getElementById("cookieModal").classList.add("hidden");
  }

  function setConsent(value) {
    setStoredConsent(value);
    closeModal();
    if (value === "accepted") {
      enableCookies();
    } else {
      disableCookies();
    }
  }

  function setCookie(name: string, value: string, days: number) {
    let expires = "";
    if (days) {
      const date = new Date();
      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
      expires = "; expires=" + date.toUTCString();
    }
    document.cookie =
      name + "=" + (value || "") + expires + "; path=/; SameSite=Strict";
  }

  function enableCookies() {
    // Enable your analytics, ad cookies, etc. here
    console.log("Cookies enabled");
  }

  function disableCookies() {
    // Remove any existing cookies
    document.cookie.split(";").forEach(function (c) {
      document.cookie = c
        .replace(/^ +/, "")
        .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
    });
    // Disable any future cookie setting
    document.cookie =
      "cookieConsent=rejected; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
  }

  document.addEventListener("DOMContentLoaded", () => {
    const acceptBtn = document.getElementById("acceptAll");
    // const customizeBtn = document.getElementById("customize");
    const rejectBtn = document.getElementById("rejectAll");

    acceptBtn.onclick = () => setConsent("accepted");
    rejectBtn.onclick = () => setConsent("rejected");
    // customizeBtn.onclick = () => {
    //   console.log("Open customization settings");
    //   // Aquí puedes implementar la lógica para abrir un modal de personalización
    //   // Por ahora, no cerramos el modal principal
    // };

    showModal();
  });
</script>
